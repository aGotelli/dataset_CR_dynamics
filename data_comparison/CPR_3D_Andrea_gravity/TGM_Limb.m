function [Delta_zeta_i_p] = TGM_Limb(i_limb,Config,Var)% Params spectralN_noeuds = Config.N_noeuds; % nombre de noeuds[DX,X_grille]=cheb(N_noeuds-1,Config.robot.limb.l(i_limb));  % sur une grille [0,L]Config.robot.limb.i_limb = i_limb;% entréesqr = Var.q(i_limb);qe = Var.q(Config.robot.nl + 1 + (i_limb-1)*Config.robot.limb.dim_qe_i:Config.robot.nl + i_limb*Config.robot.limb.dim_qe_i);Delta_qr = Var.Delta_q(i_limb);Delta_qe = Var.Delta_q(Config.robot.nl + 1 + (i_limb-1)*Config.robot.limb.dim_qe_i:Config.robot.nl + i_limb*Config.robot.limb.dim_qe_i);Delta_zeta_0 = zeros(6,1);% Forward geo gj_k% Rigid joint j=1 Delta_zeta_1_0 = Config.robot.limb.Aoi{i_limb} * Delta_qr;g1_0 = [cos(qr) -sin(qr)  0 0; sin(qr) cos(qr)  0 0;  0 0 1 0;0 0 0 1];g0_1 = inv(g1_0);Delta_zeta_1 = Ad_g_(g0_1(1:3,1:3),g0_1(1:3,4))*Delta_zeta_0 + Delta_zeta_1_0;% Soft joint j = 2for it_x = 1:N_noeuds    Phi(:,:,it_x) = Base_Phi(X_grille(it_x),Config);    Xi_a = Phi(:,:,it_x)'*qe;    Xi(:,it_x) = Config.B*Xi_a +  Config.Xi_0{i_limb};    Delta_Xi(:,it_x) = Config.B*Phi(:,:,it_x)'*Delta_qe;end    % Calcul de QuaternionCI = [1;0;0;0];CL_ind=[1,N_noeuds+1,2*N_noeuds+1,3*N_noeuds+1];f_A = @(it) quaternion_dot2(Xi(:,it));f_B = @(it) zeros(max(size(CI)),1);Q2X = integral_spectral(f_A,f_B,CI,DX,N_noeuds,CL_ind);% calcul de rCI = [0;0;0];CL_ind=[1,N_noeuds+1,2*N_noeuds+1,3*N_noeuds+1];f_A = @(it) zeros(max(size(CI)),max(size(CI)));f_B = @(it) r_dot(Q2X(:,it),Xi(4:6,it));r2X = integral_spectral(f_A,f_B,CI,DX,N_noeuds,CL_ind);g2_1 = [quaternion_to_matrice(Q2X(:,end)),r2X(:,end);0 0 0 1];CI = zeros(6,1);CL_ind=[1,N_noeuds+1,2*N_noeuds+1,3*N_noeuds+1,4*N_noeuds+1,5*N_noeuds+1];f_A = @(it) -ad_(Xi(:,it));f_B = @(it) Delta_Xi(:,it);Delta_zeta_2_1_X = integral_spectral(f_A,f_B,CI,DX,N_noeuds,CL_ind);Delta_zeta_2_1 = Delta_zeta_2_1_X(:,end);g1_2 = inv(g2_1);Delta_zeta_2 = Ad_g_(g1_2(1:3,1:3),g1_2(1:3,4))*Delta_zeta_1 + Delta_zeta_2_1;% Leaf joint j = 3Delta_zeta_3_2 = zeros(6,1);g3_2 = [Config.robot.limb.R3i{i_limb},Config.robot.limb.r3i{i_limb};0 0 0 1];g2_3 = inv(g3_2);Delta_zeta_i_p = Ad_g_(g2_3(1:3,1:3),g2_3(1:3,4))*Delta_zeta_2 + Delta_zeta_3_2;